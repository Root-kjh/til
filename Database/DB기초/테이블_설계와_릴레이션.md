# 테이블 설계와 릴레이션
---

## 데이터 모델링
>고객의 요구에 따라 특정 정보 시스템의 데이터베이스에 반영하는 작업

### Point1 : 테이블 관계 도입
---

| id | name | email | dept_name | dept_tel |
|:-------:|:-------:|:-------:|:-------:|:-------:|
| 1 | 기리조 미쯔루 | Mitsuru.Kirijo@example.com | 인사부 | 03-1234-5678 |
| 2 | 다케바 유카리 | Yukari.Takeba@example.com | 인사부 | 03-1234-5678 |
| 3 | 사토나카 치에 | Chie.Satonaka@example.com | 경리부 | 03-1234-5679 |
| 4 | 야마기시 후카 | Fuuka.Yamagishi@example.com | 인사부 | 03-1234-5678 |

이런 경우에 부서와 관련된 정보가 중복된다.

만약 부서의 전화번호를 잘못 타이핑해도 그것을 식별하기는 어려울것이다.

정보 중복의 문제를 해결하기 위해 직원은 직원 테이블, 부서는 부서 테이블로 나누어 관리해 보겠다.

| id | name | email | dept_name |
|:-------:|:-------:|:-------:|:-------:|
| 1 | 기리조 미쯔루 | Mitsuru.Kirijo@example.com | 인사부 |
| 2 | 다케바 유카리 | Yukari.Takeba@example.com | 인사부 |
| 3 | 사토나카 치에 | Chie.Satonaka@example.com | 경리부 |
| 4 | 야마기시 후카 | Fuuka.Yamagishi@example.com | 인사부 |

**emp 테이블**

| dept_name | dept_tel |
|:-------:|:-------:|
| 인사부 | 03-1234-5678 |
| 경리부 | 03-1234-5679 |

**dept 테이블**

emp 테이블에는 부서의 정보로서 부서 이름 만을갖게 해 부서 전화번호 등 이외의 정보는 dept 테이블이 갖게 하는 발상이다.

dept 테이블에서 부서이름 (dept_name)은 키가 되고, 이로 인해 부서 전화번호가 고유의 값으로 결정된다.

#### 참조 무결성 제약
>Referenitial Integrity. 외래키 제약이라고도 한다.

DB의 참조 무결성 제약을 이용하면 DB를 사용할 때 어느정도의 실수는 막아준다.

예를들어 emp 테이블에서 부서 번호 (dept_id)를 입력할 때 그 값이 dept 테이블에 있는지에 대한 여부를 자동으로 체크해준다.

만약 값이 존재하지 않으면 부서 정보가 없는 코드를 입력하려고 했다는 오류가 반환된다.

이외에도 dept 테이블의 레코드를 지우려 하면 해당 부서 번호(dept_id)가 emp 테이블에 존재하는지 확인할 수 있다.

존재하는 경우 오류를 반환하거나, 값을 비활성화(NULL)로 하거나, 각 레코드를 지우거나 하는 동작을 시킬 수 있다.

dept 테이블에 존재하지 않는 부서번호(dept_id)가 emp 테이블에 남아있다는 일어나서는 안되는 현상을 자동으로 막아준다는 면에서 우수하다.

### Point2 : 테이블 설계의 타당성 검증
---
>같은 사람이 두 개의 업무를 맡는 등, DB에서 일부분이 중복된 값을 처리해야 할 때의 여러가지 대응방식

#### 연속적인 번호의 열 도입하기

| id | name | dept_id1 | dept_id2 | dept_id3 |
|:-------:|:-------:|:-------:|:-------:|:-------:|
| 1 | 기리조 미쯔루 | 100 | NULL | NULL |
| 2 | 다케바 유카리 | 100 | NULL | NULL |
| 3 | 사토나카 치에 | 100 | 101 | NULL |
| 4 | 야마기시 후카 | 100 | NULL | NULL |

위와 같은 설계에서 전체의 부서가 3개에 포함되는 한 제대로 작동한다.

하지만 4개의 부문을 겸임하는 직원이 나타난다면 엉망이 되고 만다.

또한 대부분의 열에 NULL 값이 들어가게 되면서 낭비가 심해진다.

#### 1:N 관계를 두 개 도입하기

DB 설계상 아름다운 모델이 되게 하려면 emp와 dept 같은 **1:N** 관계를 하나 더 도입하면 좋을 것이다.

![매필 테이블](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFfcwKj99cM8AOl6Q60Bf18DlWWpl-6LC8_34cQ2X-rp01Y2u5)

출처 : [Liferay Community](https://community.liferay.com/forums/-/message_boards/message/76020920)

**매핑 테이블의 특징**

* 기본 키 값이 자주 바뀐다.
>DB 값이 변경될 때 키 값이 변경된다.

* 레코드 수가 많아진다.
>매핑 테이블의 레코드 수는 매핑의 소스가 되는 테이블보다 많다.

### 정규화 이론의 기본

#### 제1 정규형
>테이블 구성에서 중복 또는 반복, 복합값 등을 포함한 구조

예)
| id | name | email | dept_name | dept_tel |
|:-------:|:-------:|:-------:|:-------:|:-------:|
| 1 | 기리조 미쯔루 | Mitsuru.Kirijo@example.com | 인사부 | 03-1234-5678 |
| 2 | 다케바 유카리 | Yukari.Takeba@example.com | 인사부 | 03-1234-5678 |
| 3 | 사토나카 치에 | Chie.Satonaka@example.com | 경리부 | 03-1234-5679 |
| 4 | 야마기시 후카 | Fuuka.Yamagishi@example.com | 인사부 | 03-1234-5678 |

#### 제2 정규형

**제2 정규형이 아닌 테이블**

아래와 같이 기본 키가 여러 열로 구성되어 있고 그 중 일부 열의 값에 의해서만 결정되는 열이 있는 경우

| emp_id(PK) | dept_id(PK) | dept_name | created |
|:----------:|:-----------:|:---------:|:--------:|
| 1          | 100         | 인사부    | 2010-01-01|
| 2          | 100         | 인사부    | 2010-01-01|

위의 테이블의 경우 등록일(created)은 (emp_id, dept_id)의 두 가지 사항을 모르면 특정할 수 없지만, 부서 이름(dept_name)은 .dept_id만 정해지면 확인할 수 있기 떄문에 이 테이블에 속하는 것이 적절치 않다.

이에 대한 문제점은 동일 dept_id 인데도 부서명이 서로 다른 레코드가 등록될 가능성이 있다는(충돌하는) 것이다.

#### 제3 정규형

**제3 정규형이 아닌 테이블**

아래 테이블 구조를 보면 부서 번호(dept_id)의 경우 기본 키는 아니지만, 부서 이름(dept_name)은 부서 번호(dept_id)에 따라 결정되므로 기본 키의 사원 번호(emp_id)와는 직접 관련이 없다.

이러한 열을 포함하는 테이블 관계를 **제3정규형이 아니다** 라고 한다.

| emp_id(PK) | dept_id(PK) | dept_name |
|:----------:|:-----------:|:---------:|
| 1          | 100         | 인사부    |
| 2          | 100         | 인사부    |

