# 앱 작성하기
---

    파이썬으로 이루어진 무료 오픈소스 웹 프레임워크

## Django의 동작 구조

* Request 요청이 Django로 전달.

* urlresolver는 url을 가져와 일치하는 패턴의 함수(view)에 전달.

* 권한 확인 후 Response return

## Django 설치

```
pip install Django
```

### Apache와 mod_wsgi 설치



## Django 환경구성

```
django-admin startproject project-name

python manage.py startapp app-name
```

## Django 시작 명령어

```
python manage.py runserver
```

## View 작성

* views.py

```python
from django.shortcuts import render
from django.http import HttpResponse

def index(request):
    return HttpResponse("Heelo world. You're at the polls index.")
```

* urls.py

```python
from django.urls import path

from . import views

urlpatterns = [
    path('',views.index,name='index'),
]
```

* mysite의 urls.py 파일 수정

```python
from django.contrib import admin
from django.urls import include,path

urlpatterns = [
    path('polls/',include('polls.urls')),
    path('admin/', admin.site.urls),
]
```

* path() 메서드의 인수

    * route(필수) : url패턴을 가진 문자열

    * view(필수) : Django에서 일치하는 패턴을 찾으면, HttpRequest 객체를 첫번째 인수로 하고, 경로로부터 '캡처된' 값을 키워드 인수로 하여 특정한 view 함수 호출

    * kwargs(선택) : 임의의 키워드 인수들은 목표한 view에 사전형으로 전달됨

    * name(선택) : URL에 이름을 지으면, 템플릿을 포함한 Django 어디에서나 명확하게 참조할 수 있음

## Django Settings

    Settings 파일 수정

```python
LANGUAGE_CODE = 'ko-KR' # 북한의 LANGUAGE_CODE는 "ko-KP" 이다.

TIME_ZONE = 'Asia/Seoul'
```

* INSTALLED_APPS

    Django 인스턴스에서 활성화된 모든 Djnago 어플리케이션들을 지정

    * django.contrib.admin

        자동 관리 도구, /admin/ 페이지에서 관리 페이지를 이용할 수 있다.

    * django.contrib.auth

        사용자 계정, 그룹, 권한과 쿠키 기반의 사용자 세션을 다룬다.

    * django.contrib.contenttypes

        하나의 테이블에서 범용적으로 다른 테이블에 Join할 때 사용

    * django.contrib.sessions

        익명 세션을 완벽하게 지원

    * django.contrib.messages

        일회성 메시지에(플레시 메시지) 대한 지원

    * django.contrib.staticfiles

        정적 파일을 프로덕션에서 쉽게 제공 할 수 있는 단일 위치로 수집

### Django DB Setting

#### 데이터베이스 패키지 설치

* PostgreSQL
```
pip install psycopg2
```

* Oracle
```
pip install cx_Oracle
```

#### Setting DATABASES

```python
DATABASES = {
    'default':{
        'ENGINE': 'DatabaseEngine',
        'NAME': 'database_name',
        'USER':'USER',
        'PASSWORD':'PASSWORD',
        'HOST':'127.0.0.1',
        'PORT':'DatabasePort',
    }
}
```

* ATOMIC_REQUEST

    Default : False

    DB 트랜잭션 관리

* AUTOCOMMIT

    Default : True

* ENGINE

    SQLITE : django.db.backends.sqlite3

    PostgreSQL : django.db.backends.portgresql

    Mysql : django.db.backends.mysql

    Oracle : django.db.backends.oracle

* HOST

* NAME

    DB Name

* ONN_MAX_AGE

    Default : 0

    DB 연결 수명(초)

* OPTIONS

    Default : {}

    추가 매개변수

* PASSWORD

* PORT

* TIME_ZONE

    Default : Settings의 TIME_ZONE과 동일한 값 사용

* DISABLE_SERVER_SIDE_SURSORS

    Default : False

    PortgreSQL 관련 설정

* USER

* TEST

    테스트를 위한 데이터베이스 작성. 테스트가 실행되면 테스트 DB가 삭제됨

    Default : {}

    * CHARSET

    * COLLATION

    * DEPENDENCIES

    * MIRROR

        여러 db의 복제본 구성을 테스트 할 수 있도록 함

    * NAME

    * SERIALIZE

    * TEMPLATE

    ---
    Oracle 특정 설정

    * CREATE_DB

    * USER

    * PASSWORD

    * ORACLE_MANAGED_FILES

    * TBLSPACE

    * TBLSPACE_TMP

    * DATAFILE

    * DATAFILE_TMP

    * DATAFILE_MAXSIZE

    * DATAFILE_TMP_MAXSIZE

    * DATAFILE_SIZE

    * DATAFILE_TMP_SIZE

    * DATAFILE_EXTSIZE

    * DATAFILE_TMP_EXTSIZE

### 모델 만들기

    모델이란 부가적인 메타데이터를 가진 데이터베이스의 구조를 말합니다.

    Django는 DRY(Don't Repeat Yourselt) 원칙을 따릅니다. 이 원칙에 따라 데이터 모델을 한곳에서 정의하고, 이것으로 부터 자동으로 뭔가를 유도하는 것이 목표입니다.

```python
from django.db import models

class Question(models.Model):
    question_text=models.CharField(max_length=200)
    pub_date=models.DateTimeField('date published')

class Choice(models.Model):
    question=models.ForeignKey(Question,on_delete=models.CASCADE)
    choice_text=models.CharField(max_length=200)
    votes=models.IntegerField(default=0)
```

각 모델은 서브 클래스로 표시됩니다. 각 모델에는 여러 클래스 변수가 있으며 각 변수는 모델의 데이터베이스 필드를 나타냅니다.

### 모델의 활성화

    Django는 모델 코드를 이용해 데이터베이스 스키마를 생성하고 Question과 Choice 객체에 접근하기 위한 Python DB 접근 API를 생성한다.

먼저, 현재 프로젝트에 polls 앱이 설치되어 있다는 것을 알리기 위해

INSTALLED_APPS 설정을 수정한다.

```python
INSTALLED_APPS = [
    'polls.apps.PollsConfig',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]
```

```
python manage.py makemigrations polls
```

makemigrations를 실행시킴으로서, 모델을변경(생성)한 사실과 변경사항을 migration으로 저장시키고 싶다는 것을 Django에게 알린다.

```
python manage.py sqlmigrate polls 0001
```

sqlmigrate 명령은 migration 이름을 인수로 받아 실행하는 SQL 문장을 보여준다.

```SQL
BEGIN;
--
-- Create model Question
--
CREATE TABLE "polls_question" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "question_text" varchar(200) NOT NULL, "pub_date" datetime NOT NULL);
--
-- Create model Choice
--
CREATE TABLE "polls_choice" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "choice_text" varchar(200) NOT NULL, "votes" integer NOT NULL, "question_id" integer NOT NULL REFERENCES "polls_question" ("id") DEFERRABLE INITIALLY DEFERRED);
CREATE INDEX "polls_choice_question_id_c5b4b260" ON "polls_choice" ("question_id");
COMMIT;
```

* 테이블 이름은 앱의 이름과 모델의 이름이 조합되어 자동으로 생성된다.

* Django는 외래 키 필드명에 "_id" 이름을 자동으로 추가한다.

```
python manage.py migrate
```

migrate를 실행시켜 DB에 모델과 관련된 테이블을 생성한다.

